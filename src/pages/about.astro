---
import SectionHeaderTitle from '../components/SectionHeaderTitle.astro';
import Square from '../components/Square.astro';
import BaseLayout from '../layouts/BaseLayout.astro';
import SectionLayout from '../layouts/SectionLayout.astro';
---

<BaseLayout title="Mosaiq Software">
    <SectionLayout id="about">
        <Square
            width={10}
            size={800}
            color="var(--mosaiq-navy)"
            top="400px"
            left="10%"
            rotation="80deg"
        />
        <Square
            width={10}
            size={300}
            color="var(--mosaiq-magenta)"
            top="100px"
            right="10%"
            rotation="100deg"
        />
        <Square
            width={10}
            size={500}
            color="var(--mosaiq-blue)"
            top="900px"
            right="20%"
            rotation="35deg"
        />
        <div class="info">
            <SectionHeaderTitle>What?</SectionHeaderTitle>
            <div
                class="text-bubble"
                style="margin-left:25%;"
            >
                <p>We're Mosaiq Software!</p>
            </div>
            <div
                class="text-bubble"
                style="margin-left:20%;"
            >
                <p>A team of passionate developers and designers with a bizarre love for building digital tchotchkes.</p>
                <p>We craft delightful web experiences that blend creativity and technology.</p>
                <p>Our mission? To turn ideas into stunning realities, one pixel at a time.</p>
            </div>
            <div
                class="text-bubble"
                style="margin-left:40%;"
            >
                <p>Want to join us on this journey?</p>
                <p>Check out how you can <a href="/join">get involved</a>!</p>
            </div>
            <div
                class="text-bubble"
                style="margin-left:30%;"
            >
                <p>Have an idea for what we should build next? We'd love to hear from you!</p>
                <p>
                    Reach out to us at <a
                        href="mailto:hello@mosaiq.com"
                        target="_blank"
                        >hello@mosaiq.com</a
                    >
                </p>
            </div>
        </div>
        <div
            class="members"
            draggable="false"
        >
            <SectionHeaderTitle>Who?</SectionHeaderTitle>
            {
                Array.from({ length: 12 }).map((_, i) => (
                    <div class="headshot-wrapper">
                        <img
                            src={`/assets/headshots/winnie.jpg`}
                            alt="Team Member Headshot"
                            class="headshot"
                            draggable="false"
                        />
                    </div>
                ))
            }
        </div>
        <div class="timeline">
            <SectionHeaderTitle>How?</SectionHeaderTitle>
        </div>
    </SectionLayout>
</BaseLayout>
<script>
    import gsap from 'gsap';
    import { Draggable } from 'gsap/Draggable';
    import { InertiaPlugin } from 'gsap/InertiaPlugin';
    import { MotionPathPlugin } from 'gsap/MotionPathPlugin';
    import { MotionPathHelper } from 'gsap/MotionPathHelper';
    gsap.registerPlugin(Draggable, InertiaPlugin, MotionPathPlugin, MotionPathHelper);

    const headshots = document.querySelectorAll('.headshots') as NodeListOf<HTMLImageElement>;
    const headshotWrappers = document.querySelectorAll('.headshot-wrapper') as NodeListOf<HTMLDivElement>;
    const membersContainer = document.querySelector('.members') as HTMLDivElement;

    // spread out headshots around members container
    const containerCenter = {
        x: membersContainer.clientWidth / 2,
        y: membersContainer.clientHeight / 2,
    };

    headshotWrappers.forEach((wrapper, index) => {
        Draggable.create(wrapper, {
            bounds: membersContainer,
            inertia: true,
            edgeResistance: 0.65,
            type: 'x,y',
            throwProps: true,
        });
        // get a point around the center of the container based on the index
        const angle = (index / headshotWrappers.length) * Math.PI * 2;
        const radiusX = (membersContainer.clientWidth - wrapper.clientWidth) / gsap.utils.random(2, 5);
        const radiusY = (membersContainer.clientHeight - wrapper.clientHeight) / gsap.utils.random(2, 5);
        const x = containerCenter.x + radiusX * Math.cos(angle) - wrapper.clientWidth / 2;
        const y = containerCenter.y + radiusY * Math.sin(angle) - wrapper.clientHeight / 2;
        wrapper.style.top = `${y}px`;
        wrapper.style.left = `${x}px`;
    });

    headshots.forEach((headshot) => {
        // generate n random points around the center of the headshot
        const points = Array.from({ length: 5 }).map(() => {
            const angle = gsap.utils.random(0, Math.PI * 2);
            const radius = gsap.utils.random(0, 20);
            return {
                x: radius * Math.cos(angle),
                y: radius * Math.sin(angle),
            };
        });
        // animate to each point in sequence
        gsap.to(headshot, {
            duration: gsap.utils.random(2, 4),
            repeat: -1,
            motionPath: {
                path: points,
            },
        });
    });
</script>
<style>
    .members {
        width: 100%;
        height: 100vh;
        position: relative;
    }

    .headshot-wrapper {
        position: absolute;
        width: 20vmin;
        height: 20vmin;
    }
    .headshot {
        width: 100%;
        height: 100%;
        object-fit: cover;
        user-select: none;
    }

    .info {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    /* remove margin-left from text bubbles on mobile */
    @media screen and (max-width: 768px) {
        .text-bubble {
            margin-left: 0 !important;
        }
    }

    .text-bubble {
        padding: 1rem 2rem;
        backdrop-filter: blur(20px);
        width: fit-content;
        font-size: var(--font-size-lg);
    }

    a {
        color: var(--mosaiq-blue);
        text-decoration: none;
    }
</style>
